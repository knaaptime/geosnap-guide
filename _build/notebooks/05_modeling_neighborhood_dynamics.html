---
redirect_from:
  - "notebooks/05-modeling-neighborhood-dynamics"
interact_link: content/notebooks/05_modeling_neighborhood_dynamics.ipynb
kernel_name: python3
has_widgets: false
title: |-
  Modeling Neighborhood Dynamics
prev_page:
  url: /notebooks/04_modeling_neighborhood_types.html
  title: |-
    Modeling Neighborhood Types
next_page:
  url: /notebooks/06_visualizing_neighborhood_sequences.html
  title: |-
    Visualizing Neighborhood Sequences
suffix: .ipynb

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    
<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Modeling-Neighborhood-Dynamics">Modeling Neighborhood Dynamics<a class="anchor-link" href="#Modeling-Neighborhood-Dynamics"> </a></h1><p>We will use the Columbus MSA as an example to illustrate the <code>dynamics</code> module of <code>geosnap</code>.</p>
<ul>
<li>Modeling transition rates between neighborhood types across time</li>
<li>Analyzing whole neighborhood sequence</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-preperation">Data preperation<a class="anchor-link" href="#Data-preperation"> </a></h2><ul>
<li>Geodemographics for neighborhood segamentation</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">geosnap</span> <span class="k">import</span> <span class="n">Community</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">columbus</span> <span class="o">=</span> <span class="n">Community</span><span class="o">.</span><span class="n">from_ltdb</span><span class="p">(</span><span class="n">msa_fips</span><span class="o">=</span><span class="s1">&#39;18140&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">columbus1</span> <span class="o">=</span> <span class="n">columbus</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;median_household_income&#39;</span><span class="p">,</span> 
                                      <span class="s1">&#39;p_poverty_rate&#39;</span><span class="p">,</span> 
                                      <span class="s1">&#39;p_edu_college_greater&#39;</span><span class="p">,</span> 
                                      <span class="s1">&#39;p_unemployment_rate&#39;</span><span class="p">],</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">columbus1</span><span class="o">.</span><span class="n">gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>geoid</th>
      <th>n_asian_under_15</th>
      <th>n_black_under_15</th>
      <th>n_hispanic_under_15</th>
      <th>n_native_under_15</th>
      <th>n_white_under_15</th>
      <th>n_persons_under_18</th>
      <th>n_asian_over_60</th>
      <th>n_black_over_60</th>
      <th>...</th>
      <th>n_total_housing_units_sample</th>
      <th>p_nonhisp_white_persons</th>
      <th>p_white_over_60</th>
      <th>p_black_over_60</th>
      <th>p_hispanic_over_60</th>
      <th>p_native_over_60</th>
      <th>p_asian_over_60</th>
      <th>p_disabled</th>
      <th>geometry</th>
      <th>ward</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1970</td>
      <td>39041010100</td>
      <td>NaN</td>
      <td>73.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1238.000000</td>
      <td>1483.000000</td>
      <td>NaN</td>
      <td>32.000000</td>
      <td>...</td>
      <td>2001.000000</td>
      <td>NaN</td>
      <td>14.114495</td>
      <td>0.451213</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.244219</td>
      <td>POLYGON ((-83.082292 40.29946, -83.082549 40.3...</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1970</td>
      <td>39041010200</td>
      <td>NaN</td>
      <td>5.472672</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1426.479469</td>
      <td>1599.197822</td>
      <td>NaN</td>
      <td>5.387974</td>
      <td>...</td>
      <td>1529.132207</td>
      <td>NaN</td>
      <td>12.308566</td>
      <td>0.120177</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.510786</td>
      <td>POLYGON ((-83.071978 40.327509, -83.02909 40.3...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1970</td>
      <td>39041010420</td>
      <td>NaN</td>
      <td>1.505399</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>126.788033</td>
      <td>147.696350</td>
      <td>NaN</td>
      <td>0.167267</td>
      <td>...</td>
      <td>126.286232</td>
      <td>NaN</td>
      <td>9.413255</td>
      <td>0.042212</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.292529</td>
      <td>POLYGON ((-83.09434499999999 40.328399, -83.09...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1970</td>
      <td>39041010421</td>
      <td>NaN</td>
      <td>1.095593</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>92.273573</td>
      <td>107.490183</td>
      <td>NaN</td>
      <td>0.121733</td>
      <td>...</td>
      <td>91.908363</td>
      <td>NaN</td>
      <td>9.413270</td>
      <td>0.042212</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.292555</td>
      <td>POLYGON ((-83.126183 40.306402, -83.1249409999...</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1970</td>
      <td>39041010422</td>
      <td>NaN</td>
      <td>2.941651</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>247.761943</td>
      <td>288.619354</td>
      <td>NaN</td>
      <td>0.326855</td>
      <td>...</td>
      <td>246.780934</td>
      <td>NaN</td>
      <td>9.413450</td>
      <td>0.042211</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.292857</td>
      <td>POLYGON ((-83.12404599999999 40.330013, -83.11...</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 195 columns</p>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Estimating-the-transition-rates-between-neighborhood-types">Estimating the transition rates between neighborhood types<a class="anchor-link" href="#Estimating-the-transition-rates-between-neighborhood-types"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Nonspatial-transition-rates---Classic-Markov-modeling-of-transitions">Nonspatial transition rates - Classic Markov modeling of transitions<a class="anchor-link" href="#Nonspatial-transition-rates---Classic-Markov-modeling-of-transitions"> </a></h4>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">columbus1</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">cluster_col</span><span class="o">=</span><span class="s2">&quot;ward&quot;</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>giddy.markov.Markov</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">p</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0.79189189, 0.00540541, 0.0027027 , 0.13243243, 0.06216216,
        0.00540541],
       [0.0203252 , 0.75609756, 0.10569106, 0.11382114, 0.        ,
        0.00406504],
       [0.00917431, 0.20183486, 0.75229358, 0.01834862, 0.        ,
        0.01834862],
       [0.1959799 , 0.18341709, 0.00251256, 0.61809045, 0.        ,
        0.        ],
       [0.32307692, 0.        , 0.        , 0.        , 0.66153846,
        0.01538462],
       [0.09375   , 0.0625    , 0.        , 0.        , 0.        ,
        0.84375   ]])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> 
<span class="n">im</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Empircal transition rates&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/notebooks/05_modeling_neighborhood_dynamics_10_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Spatially-conditional-transition-rates---Spatial-Markov-modeling-of-transitions">Spatially conditional transition rates - Spatial Markov modeling of transitions<a class="anchor-link" href="#Spatially-conditional-transition-rates---Spatial-Markov-modeling-of-transitions"> </a></h4>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sm</span> <span class="o">=</span> <span class="n">columbus1</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">cluster_col</span><span class="o">=</span><span class="s2">&quot;ward&quot;</span><span class="p">,</span> <span class="n">w_type</span><span class="o">=</span><span class="s2">&quot;queen&quot;</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>giddy.markov.Spatial_Markov</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">p</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0.79189189, 0.00540541, 0.0027027 , 0.13243243, 0.06216216,
        0.00540541],
       [0.0203252 , 0.75609756, 0.10569106, 0.11382114, 0.        ,
        0.00406504],
       [0.00917431, 0.20183486, 0.75229358, 0.01834862, 0.        ,
        0.01834862],
       [0.1959799 , 0.18341709, 0.00251256, 0.61809045, 0.        ,
        0.        ],
       [0.32307692, 0.        , 0.        , 0.        , 0.66153846,
        0.01538462],
       [0.09375   , 0.0625    , 0.        , 0.        , 0.        ,
        0.84375   ]])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0.82413793, 0.        , 0.        , 0.10689655, 0.06896552,
        0.        ],
       [0.25      , 0.5       , 0.125     , 0.125     , 0.        ,
        0.        ],
       [0.5       , 0.        , 0.5       , 0.        , 0.        ,
        0.        ],
       [0.23809524, 0.0952381 , 0.        , 0.66666667, 0.        ,
        0.        ],
       [0.21621622, 0.        , 0.        , 0.        , 0.75675676,
        0.02702703],
       [0.16666667, 0.        , 0.        , 0.        , 0.        ,
        0.83333333]])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0.82413793, 0.        , 0.        , 0.10689655, 0.06896552,
        0.        ],
       [0.25      , 0.5       , 0.125     , 0.125     , 0.        ,
        0.        ],
       [0.5       , 0.        , 0.5       , 0.        , 0.        ,
        0.        ],
       [0.23809524, 0.0952381 , 0.        , 0.66666667, 0.        ,
        0.        ],
       [0.21621622, 0.        , 0.        , 0.        , 0.75675676,
        0.02702703],
       [0.16666667, 0.        , 0.        , 0.        , 0.        ,
        0.83333333]])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span> 
<span class="n">ls</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">classes</span>
<span class="n">lags_all</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Spatial Lag - &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>  <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">p_temp</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">p</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">p_temp</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span> <span class="n">ls</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">ls</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Global&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> 
        <span class="c1"># Loop over data dimensions and create text annotations.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">&gt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
                
            <span class="n">p_temp</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">im</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">p_temp</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span> <span class="n">ls</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">ls</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lags_all</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/notebooks/05_modeling_neighborhood_dynamics_17_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Whole-sequence-analysis">Whole sequence analysis<a class="anchor-link" href="#Whole-sequence-analysis"> </a></h2><ul>
<li>evaluate the distance/disimilarity between every pair of neighborhood sequences based on a selected sequence method</li>
<li>apply clustering algorithms to obtain a segmentation of neighborhood sequences</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(1)-Comparing-sequences-of-transitions.">(1) Comparing sequences of transitions.<a class="anchor-link" href="#(1)-Comparing-sequences-of-transitions."> </a></h3><p>transition-oriented optimal matching.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Use the sequence method to obtain the distance matrix of neighborhood sequences</span>
<span class="n">gdf_new</span><span class="p">,</span> <span class="n">df_wide</span><span class="p">,</span> <span class="n">seq_dis_mat</span> <span class="o">=</span> <span class="n">columbus1</span><span class="o">.</span><span class="n">sequence</span><span class="p">(</span><span class="n">seq_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                   <span class="n">dist_type</span><span class="o">=</span><span class="s2">&quot;tran&quot;</span><span class="p">,</span>
                                                   <span class="n">cluster_col</span><span class="o">=</span><span class="s2">&quot;ward&quot;</span><span class="p">)</span>
<span class="n">seq_dis_mat</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0., 5., 1., ..., 3., 3., 5.],
       [5., 0., 5., ..., 2., 2., 0.],
       [1., 5., 0., ..., 3., 3., 5.],
       ...,
       [3., 2., 3., ..., 0., 0., 2.],
       [3., 2., 3., ..., 0., 0., 2.],
       [5., 0., 5., ..., 2., 2., 0.]])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_wide</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>year</th>
      <th>1970</th>
      <th>1980</th>
      <th>1990</th>
      <th>2000</th>
      <th>2010</th>
      <th>tran_5</th>
    </tr>
    <tr>
      <th>geoid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>39041010100</th>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>39041010200</th>
      <td>1</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>39041010420</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>39041010421</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>39041010422</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_wide</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([3, 3, 0, 2, 3, 1])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">geosnap.visualize</span> <span class="k">import</span> <span class="n">indexplot_seq</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">indexplot_seq</span><span class="p">(</span><span class="n">df_wide</span><span class="p">,</span> <span class="n">clustering</span><span class="o">=</span><span class="s2">&quot;tran_5&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/notebooks/05_modeling_neighborhood_dynamics_24_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(2)-Hamming-distance">(2) Hamming distance<a class="anchor-link" href="#(2)-Hamming-distance"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gdf_new</span><span class="p">,</span> <span class="n">df_wide</span><span class="p">,</span> <span class="n">seq_dis_mat</span> <span class="o">=</span> <span class="n">columbus1</span><span class="o">.</span><span class="n">sequence</span><span class="p">(</span><span class="n">seq_clusters</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">dist_type</span><span class="o">=</span><span class="s2">&quot;hamming&quot;</span><span class="p">,</span> <span class="n">cluster_col</span><span class="o">=</span><span class="s2">&quot;ward&quot;</span><span class="p">)</span>
<span class="n">seq_dis_mat</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0., 3., 4., ..., 4., 4., 3.],
       [3., 0., 3., ..., 2., 2., 0.],
       [4., 3., 0., ..., 4., 4., 3.],
       ...,
       [4., 2., 4., ..., 0., 0., 2.],
       [4., 2., 4., ..., 0., 0., 2.],
       [3., 0., 3., ..., 2., 2., 0.]])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">indexplot_seq</span><span class="p">(</span><span class="n">df_wide</span><span class="p">,</span> <span class="n">clustering</span><span class="o">=</span><span class="s2">&quot;hamming_8&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/notebooks/05_modeling_neighborhood_dynamics_27_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Change the number of clusters</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gdf_new</span><span class="p">,</span> <span class="n">df_wide</span><span class="p">,</span> <span class="n">seq_dis_mat</span> <span class="o">=</span> <span class="n">columbus1</span><span class="o">.</span><span class="n">sequence</span><span class="p">(</span><span class="n">seq_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">dist_type</span><span class="o">=</span><span class="s2">&quot;hamming&quot;</span><span class="p">,</span> <span class="n">cluster_col</span><span class="o">=</span><span class="s2">&quot;ward&quot;</span><span class="p">)</span>
<span class="n">seq_dis_mat</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0., 3., 4., ..., 4., 4., 3.],
       [3., 0., 3., ..., 2., 2., 0.],
       [4., 3., 0., ..., 4., 4., 3.],
       ...,
       [4., 2., 4., ..., 0., 0., 2.],
       [4., 2., 4., ..., 0., 0., 2.],
       [3., 0., 3., ..., 2., 2., 0.]])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_wide</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([3, 3, 0, 2, 3, 2])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">indexplot_seq</span><span class="p">(</span><span class="n">df_wide</span><span class="p">,</span> <span class="n">clustering</span><span class="o">=</span><span class="s2">&quot;hamming_5&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/notebooks/05_modeling_neighborhood_dynamics_31_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(3)-Arbitrary-distance">(3) Arbitrary distance<a class="anchor-link" href="#(3)-Arbitrary-distance"> </a></h3><p>substitution=0.5, indel=1</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gdf_new</span><span class="p">,</span> <span class="n">df_wide</span><span class="p">,</span> <span class="n">seq_dis_mat</span> <span class="o">=</span> <span class="n">columbus1</span><span class="o">.</span><span class="n">sequence</span><span class="p">(</span><span class="n">seq_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                   <span class="n">dist_type</span><span class="o">=</span><span class="s2">&quot;arbitrary&quot;</span><span class="p">,</span> <span class="n">cluster_col</span><span class="o">=</span><span class="s2">&quot;ward&quot;</span><span class="p">)</span>
<span class="n">df_wide</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>year</th>
      <th>1970</th>
      <th>1980</th>
      <th>1990</th>
      <th>2000</th>
      <th>2010</th>
      <th>arbitrary_5</th>
    </tr>
    <tr>
      <th>geoid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>39041010100</th>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>39041010200</th>
      <td>1</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>39041010420</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>39041010421</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>39041010422</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">indexplot_seq</span><span class="p">(</span><span class="n">df_wide</span><span class="p">,</span> <span class="n">clustering</span><span class="o">=</span><span class="s2">&quot;arbitrary_5&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/notebooks/05_modeling_neighborhood_dynamics_34_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

 


    </main>
    