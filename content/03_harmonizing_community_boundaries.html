

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Standardizing Geographic Units Over Time &#8212; User Guide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Modeling neighborhoods and neighborhood types" href="04_modeling_neighborhood_types.html" />
    <link rel="prev" title="Working with Communitys" href="02_creating_community_datasets.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/geosnap_long.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">User Guide</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <p class="caption">
 <span class="caption-text">
  Data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01_getting_started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_creating_community_datasets.html">
   Working with
   <code class="docutils literal notranslate">
    <span class="pre">
     Community
    </span>
   </code>
   s
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Harmonizing Boundaries
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Standardizing Geographic Units Over Time
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Spatiotemporal Analytics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="04_modeling_neighborhood_types.html">
   Geodemographics &amp; Regionalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_modeling_neighborhood_dynamics.html">
   Neighborhood Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_simulating_neighborhood_dynamics.html">
   Simulating Neighborhood Change
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="07_visualizing_neighborhood_sequences.html">
   Visualizing Neighborhood Sequences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_interactive_visualization.html">
   Prototype Interactive Platform
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Additional Resources
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference external" href="https://spatialucr.github.io/geosnap/">
   API Documentation
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/spatialucr/geosnap/">
   Github Repository
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/content/03_harmonizing_community_boundaries.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#original-data">
   Original Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#harmonization-using-areal-interpolation">
   Harmonization using Areal Interpolation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#harmonization-using-dasymetric-interpolation">
   Harmonization using Dasymetric Interpolation
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="standardizing-geographic-units-over-time">
<h1>Standardizing Geographic Units Over Time<a class="headerlink" href="#standardizing-geographic-units-over-time" title="Permalink to this headline">¶</a></h1>
<p>A common issue in spatial analysis is that geographic tabulation units can (and often do) change over time. For instance the U.S. census boundary polygons like tracts and blocks are re-drawn with each census to accomodate population growth and change. That means it’s impossible to see if tract XZY has changed over time because “tract XYZ” means something different in each time period. To help solve that problem geosnap leverages the pysal <a class="reference external" href="https://pysal.org/tobler"><code class="docutils literal notranslate"><span class="pre">tobler</span></code></a> package to harmonize spatial boundaries over time. Doing so is as simple as calling the <code class="docutils literal notranslate"><span class="pre">Community.harmonize()</span></code> method</p>
<div class="section" id="original-data">
<h2>Original Data<a class="headerlink" href="#original-data" title="Permalink to this headline">¶</a></h2>
<p>First, we’ll create a new Community from San Diego county</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geosnap</span> <span class="kn">import</span> <span class="n">Community</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="stderr docutils container">
<pre class="stderr literal-block">Loading manifest: 100%|██████████| 3/3 [00:00&lt;00:00, 2798.69entries/s]
Loading manifest: 100%|██████████| 52/52 [00:00&lt;00:00, 30879.77entries/s]
Loading manifest: 100%|██████████| 5/5 [00:00&lt;00:00, 12143.32entries/s]
Loading manifest: 100%|██████████| 5/5 [00:00&lt;00:00, 12717.72entries/s]
Loading manifest: 100%|██████████| 57/57 [00:00&lt;00:00, 31846.99entries/s]
Loading manifest: 100%|██████████| 3/3 [00:00&lt;00:00, 2841.03entries/s]
</pre>
</div>
</div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">from_census</span></code> constructor, we’ll grab some original census data which by default, includes data from 1990, 2000, and 2010 and adjusts all currency columns for inflation by converting them into 2015 dollars (if you want to suppress this behavior set <code class="docutils literal notranslate"><span class="pre">constant_dollars=False</span></code>). Here’s how median contract has changed in San Diego county if we plot maps of the original boundaries</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd</span> <span class="o">=</span> <span class="n">Community</span><span class="o">.</span><span class="n">from_census</span><span class="p">(</span><span class="n">county_fips</span><span class="o">=</span><span class="s2">&quot;06073&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are several different harmonization techniques in the literature (for a deeper dive on spatial interpolation checkout the <code class="docutils literal notranslate"><span class="pre">tobler</span></code> library) but nearly all of them require good estimates of source and target polygon areas. That means it’s important to set a reasonable CRS for the study region (which should be a familiar habit anyway). In this case, <a class="reference external" href="https://epsg.io/6246">epsg 6246</a> is appropriate</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd</span><span class="o">.</span><span class="n">gdf</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">6426</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd</span><span class="o">.</span><span class="n">plot_timeseries</span><span class="p">(</span>
    <span class="s2">&quot;median_contract_rent&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Median Rent, Original Boundaries&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>SubplotsContainer([CartesianAxesSubplot(0.0279167,0.273999;0.310387x0.664281), CartesianAxesSubplot(0.354651,0.273979;0.310387x0.664319), CartesianAxesSubplot(0.681542,0.274021;0.310387x0.664235)])
</pre></div>
</div>
<img alt="../_images/03_harmonizing_community_boundaries_9_1.png" src="../_images/03_harmonizing_community_boundaries_9_1.png" />
</div>
</div>
<p>It looks like San Diego county has gotten dramatically more expensive over time, particularly through the 2000s. But since the underlying geographic units are changing over time, we still can’t make tract-to-tract comparisons, so we can harmonize the boundaries. Here we’ll take each census year and convert population and median income data into constant 2010 boundaries.</p>
</div>
<div class="section" id="harmonization-using-areal-interpolation">
<h2>Harmonization using Areal Interpolation<a class="headerlink" href="#harmonization-using-areal-interpolation" title="Permalink to this headline">¶</a></h2>
<p>The simplest way to harmonize boundaries is to use areal interpolation, meaning we use the area of overlap between consecutive years to create a weighted sum of intersecting polygons. This approach assumes each polygon has constant density of each attribute so its most useful when the polygons are small and homogenous</p>
<p>When harmonizing boundaries over time, we need to distinguish between <a class="reference external" href="https://en.wikipedia.org/wiki/Intensive_and_extensive_properties">intensive and extensive</a> variables because each needs to be handled differently during the interpolation process. Median income is a statistic (so intensive), whereas total population is a count (extensive), so we make sure to pass each to the appropriate list</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd_harm10</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">harmonize</span><span class="p">(</span>
    <span class="n">intensive_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_contract_rent&quot;</span><span class="p">,</span> <span class="s1">&#39;p_hispanic_persons&#39;</span><span class="p">],</span>
    <span class="n">extensive_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;n_total_pop&quot;</span><span class="p">],</span>
    <span class="n">weights_method</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
    <span class="n">target_year</span><span class="o">=</span><span class="mi">2010</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "498ee66b63e9408397734f591b0753b9", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Harmonizing 1990
Harmonizing 2000

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd_harm10</span><span class="o">.</span><span class="n">plot_timeseries</span><span class="p">(</span>
    <span class="s2">&quot;median_contract_rent&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Median Rent, 2010 Boundaries&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>SubplotsContainer([CartesianAxesSubplot(0.0279167,0.274092;0.310331x0.664094), CartesianAxesSubplot(0.354755,0.274092;0.310331x0.664094), CartesianAxesSubplot(0.681594,0.274092;0.310331x0.664094)])
</pre></div>
</div>
<img alt="../_images/03_harmonizing_community_boundaries_16_1.png" src="../_images/03_harmonizing_community_boundaries_16_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd_harm10</span><span class="o">.</span><span class="n">plot_timeseries</span><span class="p">(</span>
    <span class="s2">&quot;p_hispanic_persons&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hispanic Population (%), 2010 Boundaries&quot;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>SubplotsContainer([CartesianAxesSubplot(0.0279167,0.274092;0.310331x0.664094), CartesianAxesSubplot(0.354755,0.274092;0.310331x0.664094), CartesianAxesSubplot(0.681594,0.274092;0.310331x0.664094)])
</pre></div>
</div>
<img alt="../_images/03_harmonizing_community_boundaries_17_1.png" src="../_images/03_harmonizing_community_boundaries_17_1.png" />
</div>
</div>
<p>We could also use 1990 boundaries as our target to see how the region has evolved according to those units:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd_harm90</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">harmonize</span><span class="p">(</span>
    <span class="n">intensive_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_contract_rent&quot;</span><span class="p">],</span>
    <span class="n">weights_method</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
    <span class="n">target_year</span><span class="o">=</span><span class="mi">1990</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sd_harm90</span><span class="o">.</span><span class="n">plot_timeseries</span><span class="p">(</span>
    <span class="s2">&quot;median_contract_rent&quot;</span><span class="p">,</span> 
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Median Rent, 1990 Boundaries&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "82391d729f1949b0b7b2deda8655381a", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Harmonizing 2000
Harmonizing 2010
</pre></div>
</div>
<div class="stderr docutils container">
<pre class="stderr literal-block">/Users/knaaptime/Dropbox/projects/tobler/tobler/util/util.py:28: UserWarning: nan values in variable: median_contract_rent, replacing with 0
  warn(f&quot;nan values in variable: {column}, replacing with 0&quot;)
</pre>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>SubplotsContainer([CartesianAxesSubplot(0.0279167,0.27388;0.310497x0.664517), CartesianAxesSubplot(0.354755,0.27388;0.310497x0.664517), CartesianAxesSubplot(0.681594,0.27388;0.310497x0.664517)])
</pre></div>
</div>
<img alt="../_images/03_harmonizing_community_boundaries_19_5.png" src="../_images/03_harmonizing_community_boundaries_19_5.png" />
</div>
</div>
</div>
<div class="section" id="harmonization-using-dasymetric-interpolation">
<h2>Harmonization using Dasymetric Interpolation<a class="headerlink" href="#harmonization-using-dasymetric-interpolation" title="Permalink to this headline">¶</a></h2>
<p>To account for the fact that most variables are not distributed uniformly thoughout the polygon (e.g. development is often clustered rather than spread evenly throughout each census tract), geosnap can use <a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6420221/">dasymetric interpolation</a> that incorporates additional information for a more accurate harmonization. In this case, we can use raster data like <a class="reference external" href="https://www.mrlc.gov/">the NLCD</a> to constrain our interpolation to only the developed part of each census tract.</p>
<p><a class="reference external" href="https://spatial.ucr.edu">spatialucr</a> distributes an optimized version of the NLCD data through its <a class="reference external" href="https://open.quiltdata.com/b/spatial-ucr">quilt bucket</a> for use in harmonization so we can download it simply using quilt. Since we’re harmonizing boundaries from the past, our auxiliary data should roughly match the time period of the polygon data we’re converting. The earliest version of the NLCD available is 2001, so we’ll use that</p>
<p>(note the next cell will download a 1.5gb tif file into the working directory)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">quilt3</span>

<span class="n">quilt3</span><span class="o">.</span><span class="n">Package</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="s2">&quot;rasters/nlcd&quot;</span><span class="p">,</span> <span class="s2">&quot;s3://spatial-ucr&quot;</span><span class="p">)[</span><span class="s2">&quot;nlcd_2001.tif&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="s2">&quot;./&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To use dasymetric harmonization, we need to change the <code class="docutils literal notranslate"><span class="pre">weights_method</span></code> and provide a path to a valid raster file (which, in this case, we just downloaded to th current dir). When using a raster file as a dasymetric mask, we need to tell the function which raster cells are part of the mask. In this case, the pixels in the NLCD raster to different land use types, and we want to constrain the interpolation to developed land. So here we’ll set the <code class="docutils literal notranslate"><span class="pre">codes</span></code> argument to the developed land types from the nlcd:</p>
<ul class="simple">
<li><p>21 (Developed, Open Space)</p></li>
<li><p>22 (Developed, Low Intensity)</p></li>
<li><p>23 (Developed, Medium Intensity)</p></li>
<li><p>24 (Developed, High Intensity)</p></li>
</ul>
<p>(which are also the defaults)</p>
<p>Note: dasymetric interpolation is much more data intensive so it takes considerably longer to calculate. On my machine it takes roughly 4 minutes per time period for this study area, whereas the pure areal interpolation completes in a few seconds each</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd_harm10_dasy</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">harmonize</span><span class="p">(</span>
    <span class="n">intensive_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_contract_rent&quot;</span><span class="p">],</span>
    <span class="n">weights_method</span><span class="o">=</span><span class="s2">&quot;dasymetric&quot;</span><span class="p">,</span>
    <span class="n">raster</span><span class="o">=</span><span class="s1">&#39;nlcd_2001.tif&#39;</span><span class="p">,</span>
    <span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">],</span>
    <span class="n">target_year</span><span class="o">=</span><span class="mi">2010</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "43c5d392180e4ec7b8cd66dace0e6546", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Harmonizing 1990
</pre></div>
</div>
<div class="stderr docutils container">
<pre class="stderr literal-block">/Users/knaaptime/Dropbox/projects/tobler/tobler/area_weighted/area_interpolate.py:494: UserWarning: The CRS for the generated union will be set to be the same as source_df.
  &quot;The CRS for the generated union will be set to be the same as source_df.&quot;
/Users/knaaptime/anaconda3/envs/geosnap/lib/python3.7/site-packages/rasterstats/io.py:301: UserWarning: Setting nodata to -999; specify nodata explicitly
  warnings.warn(&quot;Setting nodata to -999; specify nodata explicitly&quot;)
</pre>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Harmonizing 2000
</pre></div>
</div>
<div class="stderr docutils container">
<pre class="stderr literal-block">/Users/knaaptime/Dropbox/projects/tobler/tobler/area_weighted/area_interpolate.py:494: UserWarning: The CRS for the generated union will be set to be the same as source_df.
  &quot;The CRS for the generated union will be set to be the same as source_df.&quot;
/Users/knaaptime/anaconda3/envs/geosnap/lib/python3.7/site-packages/rasterstats/io.py:301: UserWarning: Setting nodata to -999; specify nodata explicitly
  warnings.warn(&quot;Setting nodata to -999; specify nodata explicitly&quot;)
</pre>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sd_harm10_dasy</span><span class="o">.</span><span class="n">plot_timeseries</span><span class="p">(</span>
    <span class="s2">&quot;median_contract_rent&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Median Rent, 2010 Boundaries w/ Dasymetric Interpolation&quot;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>SubplotsContainer([CartesianAxesSubplot(0.0279167,0.274092;0.310331x0.664094), CartesianAxesSubplot(0.354755,0.274092;0.310331x0.664094), CartesianAxesSubplot(0.681594,0.274092;0.310331x0.664094)])
</pre></div>
</div>
<img alt="../_images/03_harmonizing_community_boundaries_27_1.png" src="../_images/03_harmonizing_community_boundaries_27_1.png" />
</div>
</div>
<p>The NLCD is a useful dasymetric layer because it has high spatial resolution and classifies a relatively wide range of land uses. By constraining our interpolation to developed land uses we ensure that there are no variables allocated to obviously incorrect places like forests, lakes, or farms. But it doesnt do anything to prevent allocating variables to  developed land uses that don’t have population–like heavy industry, airports, parking lots, or shopping malls. Depending on the particular problem and location, you may want to inclue or exclude different pixel types. There may also be better raster sources that could be used as alternatives</p>
</div>
</div>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {"026c966d8f0a43beaef0391084df2ecf": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"description_width": ""}}, "031d83135f6e43719faccc42e2bdb2ad": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"description_width": "initial"}}, "06a2b8d254924c71a73caee27d061fdb": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}, "1889ea36c7974f5b90ddae7fe3cd3418": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"description_width": ""}}, "25709d7cc46c4fcb952cf41dfbbf1459": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"description_width": "initial"}}, "3637cdf0e7f74641a3b2864ec631de4f": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}, "43c5d392180e4ec7b8cd66dace0e6546": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"children": ["IPY_MODEL_466e5984816e4226b4e92df25ee41819", "IPY_MODEL_b016b64cda0a40238d20407765f5b3f3"], "layout": "IPY_MODEL_915371743bf7425c8ef9068078b4e090"}}, "466e5984816e4226b4e92df25ee41819": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"bar_style": "success", "description": "Complete: 100%", "layout": "IPY_MODEL_5efdbf87593a43d0823396697d189f8e", "max": 2, "style": "IPY_MODEL_25709d7cc46c4fcb952cf41dfbbf1459", "value": 2}}, "498ee66b63e9408397734f591b0753b9": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"children": ["IPY_MODEL_b3e51654525e4f3f910a820985dbf603", "IPY_MODEL_9be6161ef8a34772bb28a4923e780a2b"], "layout": "IPY_MODEL_c0ad959be16643e7a1f6df1835083ef3"}}, "5efdbf87593a43d0823396697d189f8e": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}, "82391d729f1949b0b7b2deda8655381a": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"children": ["IPY_MODEL_ac1489d281854829a9510aabc5bfcf3e", "IPY_MODEL_9582220cfe01487fb12eae08c3451bf7"], "layout": "IPY_MODEL_bf390f7f324e4841913897b22cc2bf04"}}, "915371743bf7425c8ef9068078b4e090": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}, "93ecc505361d4d58a7d62311808343af": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}, "9582220cfe01487fb12eae08c3451bf7": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"layout": "IPY_MODEL_93ecc505361d4d58a7d62311808343af", "style": "IPY_MODEL_b09f7bc3bd444484af8a985b3825054c", "value": " 2/2 [03:30&lt;00:00, 105.38s/it]"}}, "9be6161ef8a34772bb28a4923e780a2b": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"layout": "IPY_MODEL_c9953fc377c54882b0fb5a2c6da7af05", "style": "IPY_MODEL_1889ea36c7974f5b90ddae7fe3cd3418", "value": " 2/2 [00:06&lt;00:00,  3.11s/it]"}}, "ac1489d281854829a9510aabc5bfcf3e": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"bar_style": "success", "description": "Complete: 100%", "layout": "IPY_MODEL_06a2b8d254924c71a73caee27d061fdb", "max": 2, "style": "IPY_MODEL_031d83135f6e43719faccc42e2bdb2ad", "value": 2}}, "b016b64cda0a40238d20407765f5b3f3": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"layout": "IPY_MODEL_d1a06e7d775949e18554227357d925ca", "style": "IPY_MODEL_026c966d8f0a43beaef0391084df2ecf", "value": " 2/2 [06:50&lt;00:00, 205.22s/it]"}}, "b09f7bc3bd444484af8a985b3825054c": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"description_width": ""}}, "b3e51654525e4f3f910a820985dbf603": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"bar_style": "success", "description": "Complete: 100%", "layout": "IPY_MODEL_3637cdf0e7f74641a3b2864ec631de4f", "max": 2, "style": "IPY_MODEL_cd8da2248cc24ad4b5ac01ba914dc2ed", "value": 2}}, "bf390f7f324e4841913897b22cc2bf04": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}, "c0ad959be16643e7a1f6df1835083ef3": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}, "c9953fc377c54882b0fb5a2c6da7af05": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}, "cd8da2248cc24ad4b5ac01ba914dc2ed": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"description_width": "initial"}}, "d1a06e7d775949e18554227357d925ca": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {}}}, "version_major": 2, "version_minor": 0}
</script>


    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-geosnap-py"
        },
        kernelOptions: {
            kernelName: "conda-env-geosnap-py",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-geosnap-py'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="02_creating_community_datasets.html" title="previous page">Working with <code class="docutils literal notranslate"><span class="pre">Community</span></code>s</a>
    <a class='right-next' id="next-link" href="04_modeling_neighborhood_types.html" title="next page">Modeling neighborhoods and neighborhood types</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By geosnap developers<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>